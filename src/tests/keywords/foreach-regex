# PRE: foreach if-regex-match afrom_file

# This is what most people end up using foreach for,
# so we should probably test it works.
&Tmp-String-0 := "cisco"

# Expanded regex
foreach &Vendor-Specific.Cisco.AVPair {
	if ("%{Foreach-Variable-0}"  =~ /^%{Tmp-String-0}=(.*)$/i) {
		&reply += {
			&Called-Station-Id = "%{1}"
		}
	}
}

# Compiled regex
foreach &Vendor-Specific.Cisco.AVPair {
	if ("%{Foreach-Variable-0}"  =~ /^stupid=(.*)$/i) {
		&reply += {
			&Called-Station-Id = "%{1}"
		}
	}
}

if ("%{reply.Called-Station-Id[#]}" != 2) {
	test_fail
}

if (&reply.Called-Station-Id[0] != "3") {
	test_fail
}

if (&reply.Called-Station-Id[1] != "1") {
	test_fail
}
